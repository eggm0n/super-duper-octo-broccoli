{% set sanitized_branch = (branch or "dev").replace('/', '-') %}

name: proxy-service
namespace: broccoli

containers:
 - dockerfile: Dockerfile
   rebuild:
     root: /root
     command: sbt assembly
     sources:
       - src
       - build.sbt
       - run_jar.sh

profiles:
  stable:
    endpoint: /proxy
    max_memory: 0.25G
    max_cpu: 0.25
  canary:
    endpoint: /proxy
    weight: 50 # percentage of traffic to route to this class of deployment
    max_memory: 0.25G
    max_cpu: 0.25
  default:
    name: {{sanitized_branch}}
    endpoint: /{{sanitized_branch}}/proxy
    max_memory: 0.25G
    max_cpu: 0.2

branches:
  master: stable
  dev/*: default
